# 更新日志

本文档记录了呈尚策划人事管理系统的所有重要更改。

## [0.1.1] - 2025-09-11

### 🔧 架构优化

#### 组件重构
- **UI组件重组**：将 `src/components/ui/` 按功能分类
  - `basic/`: 基础UI组件（button, card, badge等）
  - `form/`: 表单相关组件（input, select, textarea等）
  - `layout/`: 布局相关组件（navigation, sidebar, table等）
  - `interaction/`: 交互组件（dialog, dropdown, tooltip等）
- **业务组件重组**：将 `src/components/forms/` 按模块分类
  - `employee/`: 员工相关表单组件
  - `business/`: 业务表单组件（奖励、招聘、积分）
- **代码质量管控**：严格执行文件规模控制和目录结构规范

#### 导入路径更新
- 更新了200+个文件的组件导入路径
- 自动化处理组件路径重构
- 保持代码的一致性和可维护性

### 📋 招聘管理增强

#### 年龄字段新增
- **必填年龄字段**：新增年龄为必填项，支持16-70岁范围验证
- **数据迁移**：自动为现有记录添加默认年龄值（25岁）
- **类型验证**：支持前端字符串输入，自动转换为数字类型

#### 身份证字段优化
- **可选字段**：身份证号改为可选字段，提升使用灵活性
- **索引优化**：使用稀疏索引处理可选字段的唯一性约束
- **隐私保护**：继续保持身份证号的隐私保护功能

#### 表单体验改进
- **受控组件修复**：解决React "uncontrolled to controlled" 警告
- **默认值处理**：数字字段使用空字符串默认值，避免undefined状态
- **数据转换**：在表单提交时智能转换数据类型

### 🛠️ 技术修复

#### Next.js 15 兼容性
- **异步Params**：修复API路由中params的异步访问问题
- **类型安全**：更新函数签名为 `{ params: Promise<{ id: string }> }`
- **错误处理**：完善异步操作的错误边界

#### 数据库优化
- **索引重复警告**：修复Mongoose重复索引警告
- **字段验证**：优化Mongoose schema验证逻辑
- **数据一致性**：确保新旧数据的兼容性

#### API接口改进
- **Zod验证优化**：支持字符串到数字的智能转换
- **错误处理增强**：提供更详细的错误信息和调试支持
- **请求日志**：添加完整的请求响应日志系统

### 🔍 调试与开发体验

#### 调试支持
- **前端调试**：完善的浏览器控制台日志
- **后端调试**：详细的服务器端请求追踪
- **错误追踪**：优化错误边界和异常处理

#### 开发工具
- **调试API**：临时调试接口用于问题排查
- **数据迁移工具**：自动化数据库架构升级
- **健康检查**：系统状态监控和诊断

### 🐛 问题修复

- 修复招聘记录更新时年龄字段不显示的问题
- 修复React受控组件警告
- 修复Next.js API路由参数访问问题
- 修复Mongoose重复索引警告
- 修复前端缓存导致的数据不刷新问题
- 修复Zod schema验证中的类型转换问题

### 📚 文档更新

- 更新README.md，添加最新功能特性说明
- 新增故障排除指南和常见问题解答
- 更新项目目录结构说明
- 添加开发调试指南

## [0.1.0] - 2025-09-09

### 新增功能 ✨

#### 系统主页
- 实时仪表盘显示关键业务指标
- 系统状态监控（数据库响应时间、系统状态）
- 系统价值介绍（招聘记录管理和员工贡献评估系统）
- 快速功能导航

#### 招聘记录管理
- 招聘概览统计卡片（招聘总人数、试岗率、试岗离职率、平均试岗天数）
- 完整的面试记录管理
- 试岗状态跟踪和管理
- 招聘状态流转（面试中、试岗中、已录用、已拒绝）
- Excel 数据导出功能

#### 员工信息管理
- 员工概览统计卡片（员工总数、在职员工数、平均在职天数、积分最多员工）
- 员工档案完整管理
- 部门岗位管理
- 在职状况跟踪
- 多条件搜索和筛选

#### 积分管理系统
- 积分记录的增删改查
- 行为分类管理（工作表现、考勤情况、团队协作等）
- 积分统计和趋势分析
- 证据文件上传管理

#### 年度评优管理
- 年度评优记录管理
- 综合评分算法（积分 60% + 考勤 20% + 绩效 20%）
- 奖项等级管理（特等奖、一等奖、二等奖、三等奖）
- 专业获奖证书生成和打印
- 年度评优数据统计

### 技术特性 🛠️

#### 前端技术
- Next.js 15 with App Router
- React 19 + TypeScript
- Tailwind CSS 4 响应式设计
- Radix UI 无障碍组件库
- React Hook Form + Zod 表单验证
- Recharts 数据可视化

#### 后端技术
- Next.js API Routes
- MongoDB + Mongoose ODM
- RESTful API 设计
- 数据验证和错误处理

#### 功能特性
- 完全响应式设计，支持桌面端、平板、移动设备
- 实时数据统计和图表展示
- Excel 数据导出功能
- PDF 证书生成和打印优化
- 数据库自动索引优化
- TypeScript 类型安全

### 数据模型 📊

- **Employee**: 员工信息模型
- **RecruitmentRecord**: 招聘记录模型
- **ScoreRecord**: 积分记录模型
- **AnnualAward**: 年度评优模型

### API 接口 🔌

#### 统计接口
- `GET /api/dashboard/stats` - 主页统计数据
- `GET /api/recruitment/overview` - 招聘概览统计
- `GET /api/employees/overview` - 员工概览统计

#### 数据管理接口
- `/api/employees` - 员工管理 CRUD
- `/api/recruitment` - 招聘管理 CRUD
- `/api/scores` - 积分管理 CRUD
- `/api/awards` - 年度评优管理 CRUD

### 已知问题 🐛

- 暂无已知问题

### 计划功能 📋

- [ ] 用户认证和权限管理
- [ ] 邮件通知功能
- [ ] 数据备份和恢复
- [ ] 多语言支持
- [ ] 移动端 PWA 支持
- [ ] 高级数据分析和报表
- [ ] 系统日志和审计功能

---

## 版本说明

版本号格式：`主版本号.次版本号.修订号`

- **主版本号**：不兼容的 API 修改
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正
